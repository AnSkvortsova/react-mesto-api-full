(this["webpackJsonpmesto-react"]=this["webpackJsonpmesto-react"]||[]).push([[0],{30:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(20),i=n.n(s),o=n(8),r=(n(30),n(24)),l=n(2),u=n(3),p=n(0);function d(){return Object(p.jsx)("footer",{className:"footer page__section",children:Object(p.jsx)("p",{className:"footer__copyright",children:"\xa9 2021 Mesto Russia"})})}var j=n.p+"static/media/logo.03b78ada.svg";function b(e){var t=Object(a.useState)(!1),n=Object(l.a)(t,2),c=n[0],s=n[1];return Object(p.jsxs)("header",{className:"header page__section",children:[Object(p.jsx)("div",{className:"header__line"}),Object(p.jsx)("img",{className:"logo",src:j,alt:"\u043b\u043e\u0433\u043e\u0442\u0438\u043f"}),Object(p.jsxs)(u.d,{children:[Object(p.jsx)(u.b,{path:"/signin",children:Object(p.jsx)(o.b,{to:"/signup",className:"header__link",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"})}),Object(p.jsx)(u.b,{path:"/signup",children:Object(p.jsx)(o.b,{to:"/signin",className:"header__link",children:"\u0412\u043e\u0439\u0442\u0438"})}),Object(p.jsx)(u.b,{path:"/",children:Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("button",{className:"header__menu ".concat(c?"header__menu_hidden":""),type:"button","aria-label":"\u043c\u0435\u043d\u044e",onClick:function(){s(!0)}}),Object(p.jsx)("button",{className:"header__menu-close ".concat(c?"":"header__menu-close_hidden"),type:"button","aria-label":"\u0437\u0430\u043a\u0440\u044b\u0442\u044c \u043c\u0435\u043d\u044e",onClick:function(){s(!1)}}),Object(p.jsxs)("div",{className:"header__container ".concat(c?"header__container_mobile":""),children:[Object(p.jsx)("p",{className:"header__email",children:e.userEmail}),Object(p.jsx)(o.b,{to:"/signin",className:"header__link-out",onClick:e.onLogout,children:"\u0412\u044b\u0439\u0442\u0438"})]})]})})]})]})}var h=n.p+"static/media/pencil.a086f758.svg",m=c.a.createContext();function _(e){var t=c.a.useContext(m),n=e.card.owner===t._id,a="element__trash ".concat(n?"":"element__trash_hidden"),s=e.card.likes.some((function(e){return e===t._id})),i="element__heart ".concat(s?"element__heart_active":"");return Object(p.jsxs)("article",{className:"element",children:[Object(p.jsx)("img",{className:"element__image",src:e.card.link,alt:e.card.name,onClick:function(){e.onCardClick(e.card)}}),Object(p.jsx)("button",{className:a,type:"button","aria-label":"\u0443\u0434\u0430\u043b\u0438\u0442\u044c",onClick:function(){e.onDeleteClick(e.card)}}),Object(p.jsxs)("div",{className:"element__bottom",children:[Object(p.jsx)("h2",{className:"element__text",children:e.card.name}),Object(p.jsxs)("div",{className:"element__likes",children:[Object(p.jsx)("button",{className:i,type:"button","aria-label":"\u043e\u0442\u043c\u0435\u0442\u0438\u0442\u044c \u043a\u0430\u043a \u043d\u0440\u0430\u0432\u0438\u0442\u044c\u0441\u044f",onClick:function(){e.onCardLike(e.card)}}),Object(p.jsx)("p",{className:"element__number",children:e.card.likes.length})]})]})]})}function O(e){var t=c.a.useContext(m);return Object(p.jsxs)("main",{className:"main",children:[Object(p.jsx)("section",{className:"profile page__section",children:Object(p.jsxs)("div",{className:"profile__box",children:[Object(p.jsxs)("div",{className:"profile__avatar",onClick:e.onEditAvatar,children:[Object(p.jsx)("img",{className:"profile__image",alt:"\u0410\u0432\u0430\u0442\u0430\u0440",src:t.avatar}),Object(p.jsx)("img",{className:"profile__pencil",src:h,alt:"\u041a\u0430\u0440\u0430\u043d\u0434\u0430\u0448"})]}),Object(p.jsxs)("div",{className:"profile__info",children:[Object(p.jsxs)("div",{className:"profile__row",children:[Object(p.jsx)("h1",{className:"profile__title",children:t.name}),Object(p.jsx)("button",{className:"profile__edit-button",type:"button","aria-label":"\u0440\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c",onClick:e.onEditProfile})]}),Object(p.jsx)("p",{className:"profile__subtitle",children:t.about})]}),Object(p.jsx)("button",{className:"profile__add-button",type:"button","aria-label":"\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c",onClick:e.onAddPlace})]})}),Object(p.jsx)("section",{className:"elements page__section",children:e.cards.map((function(t){return Object(p.jsx)(_,{card:t,onCardClick:e.onCardClick,onDeleteClick:e.onDeleteClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete},t._id)}))})]})}function f(e){return Object(p.jsx)("div",{className:"popup popup_type_".concat(e.name," ").concat(e.isOpen?"popup_opend":""),children:Object(p.jsxs)("div",{className:"popup__container",id:"popup__".concat(e.name,"-container"),children:[Object(p.jsx)("button",{className:"popup__close",id:"popup__".concat(e.name,"-close"),type:"button","aria-label":"\u0437\u0430\u043a\u0440\u044b\u0442\u044c",onClick:e.onClose}),Object(p.jsx)("h2",{className:"popup__title",children:e.title}),Object(p.jsxs)("form",{className:"popup__form",name:e.name,onSubmit:e.onSubmit,children:[e.children,Object(p.jsx)("button",{className:"popup__submit",id:"popup__submit-".concat(e.name),type:"submit","aria-label":"\u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",children:e.button})]})]})})}function x(e){var t=c.a.useContext(m),n=Object(a.useState)(""),s=Object(l.a)(n,2),i=s[0],o=s[1],r=Object(a.useState)(""),u=Object(l.a)(r,2),d=u[0],j=u[1];return Object(a.useEffect)((function(){o(t.name),j(t.about)}),[t,e.isOpen]),Object(p.jsxs)(f,{name:"edit",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",button:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:i,about:d})},children:[Object(p.jsx)("input",{className:"popup__input",minLength:"2",maxLength:"40",id:"input-name",name:"userName",type:"text",value:i||"",onChange:function(e){o(e.target.value)},required:!0}),Object(p.jsx)("span",{className:"popup__input-error",id:"input-name-error"}),Object(p.jsx)("input",{className:"popup__input",minLength:"2",maxLength:"200",id:"input-job",name:"userJob",type:"text",value:d||"",onChange:function(e){j(e.target.value)},required:!0}),Object(p.jsx)("span",{className:"popup__input-error",id:"input-job-error"})]})}function v(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),c=n[0],s=n[1],i=Object(a.useState)(""),o=Object(l.a)(i,2),r=o[0],u=o[1];return Object(p.jsxs)(f,{name:"add",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",button:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onAddPlace({name:c,link:r}),s(""),u("")},children:[Object(p.jsx)("input",{className:"popup__input",minLength:"2",maxLength:"30",id:"input-place",name:"name",type:"text",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",value:c,onChange:function(e){s(e.target.value)},required:!0}),Object(p.jsx)("span",{className:"popup__input-error",id:"input-place-error"}),Object(p.jsx)("input",{className:"popup__input",id:"input-link",name:"link",type:"url",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",value:r,onChange:function(e){u(e.target.value)},required:!0}),Object(p.jsx)("span",{className:"popup__input-error",id:"input-link-error"})]})}function g(e){var t=Object(a.useRef)();return Object(p.jsxs)(f,{name:"avatar",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",button:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(n){n.preventDefault(),e.onUpdateAvatar({avatar:t.current.value}),t.current.value=""},children:[Object(p.jsx)("input",{className:"popup__input",id:"input-avatar",name:"avatar",type:"url",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430",ref:t,required:!0}),Object(p.jsx)("span",{className:"popup__input-error",id:"input-avatar-error"})]})}function N(e){return Object(p.jsx)("div",{className:"popup popup_type_image ".concat(e.card?"popup_opend":""),children:Object(p.jsxs)("div",{className:"popup__img-container",children:[Object(p.jsx)("button",{className:"popup__close",id:"popup__img-close",type:"button","aria-label":"\u0437\u0430\u043a\u0440\u044b\u0442\u044c",onClick:e.onClose}),Object(p.jsxs)("figure",{className:"popup__figure",children:[Object(p.jsx)("img",{className:"popup__image-big",src:e.card.link,alt:e.card.name}),Object(p.jsx)("figcaption",{className:"popup__text",children:e.card.name})]})]})})}function C(e){return Object(p.jsx)(f,{name:"delete",title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",button:"\u0414\u0430",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onCardDelete(e.isOpen)}})}var k=n(22),y=n(23),S=new(function(){function e(t){Object(k.a)(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}return Object(y.a)(e,[{key:"_checkResult",value:function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}},{key:"getUserInfo",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/users/me"),{credentials:"include",headers:this._headers}).then((function(t){return e._checkResult(t)}))}},{key:"pushUserInfo",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",credentials:"include",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return t._checkResult(e)}))}},{key:"getInitialCards",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/cards"),{credentials:"include",headers:this._headers}).then((function(t){return e._checkResult(t)}))}},{key:"pushNewCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",credentials:"include",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return t._checkResult(e)}))}},{key:"setLikeCard",value:function(e,t){var n=this,a=t?"DELETE":"PUT";return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:a,credentials:"include",headers:this._headers}).then((function(e){return n._checkResult(e)}))}},{key:"removeCard",value:function(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",credentials:"include",headers:this._headers}).then()}},{key:"updateAvatar",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",credentials:"include",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then((function(e){return t._checkResult(e)}))}}]),e}())({baseUrl:"https://api.workofplace.nomoredomains.club",headers:{"Content-Type":"application/json"}}),L=n(11),E=n(9);function w(e){var t=Object(a.useState)({email:"",password:""}),n=Object(l.a)(t,2),c=n[0],s=n[1],i=c.email,r=c.password;function u(e){var t=e.target,n=t.name,a=t.value;s(Object(E.a)(Object(E.a)({},c),{},Object(L.a)({},n,a)))}return Object(p.jsxs)("div",{className:"auth",children:[Object(p.jsx)("h2",{className:"auth__title",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(p.jsxs)("form",{className:"auth__form",onSubmit:function(t){t.preventDefault(),e.onRegisterSubmit(r,i),s({email:"",password:""})},children:[Object(p.jsxs)("div",{className:"auth__inputs-container",children:[Object(p.jsx)("input",{className:"auth__input",type:"text",name:"email",value:i||"",onChange:u,placeholder:"Email"}),Object(p.jsx)("input",{className:"auth__input",type:"text",name:"password",value:r||"",onChange:u,placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c"})]}),Object(p.jsx)("button",{className:"auth__button",type:"submit","aria-label":"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"})]}),Object(p.jsx)("div",{className:"auth__link-container",children:Object(p.jsx)(o.b,{to:"/signin",className:"auth__link",children:"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? \u0412\u043e\u0439\u0442\u0438"})})]})}function U(e){var t=Object(a.useState)({email:"",password:""}),n=Object(l.a)(t,2),c=n[0],s=n[1],i=c.email,o=c.password;function r(e){var t=e.target,n=t.name,a=t.value;s(Object(E.a)(Object(E.a)({},c),{},Object(L.a)({},n,a)))}return Object(p.jsxs)("div",{className:"auth",children:[Object(p.jsx)("h2",{className:"auth__title",children:"\u0412\u0445\u043e\u0434"}),Object(p.jsxs)("form",{className:"auth__form",onSubmit:function(t){t.preventDefault(),e.onLoginSubmit(o,i),s({email:"",password:""})},children:[Object(p.jsxs)("div",{className:"auth__inputs-container",children:[Object(p.jsx)("input",{className:"auth__input",type:"text",name:"email",value:i||"",onChange:r,placeholder:"Email"}),Object(p.jsx)("input",{className:"auth__input",type:"text",name:"password",value:o||"",onChange:r,placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c"})]}),Object(p.jsx)("button",{className:"auth__button",type:"submit","aria-label":"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f",children:"\u0412\u043e\u0439\u0442\u0438"})]})]})}var D=n(25),P=["isLoggedIn"];function T(e){var t=e.isLoggedIn,n=Object(D.a)(e,P);return t?Object(p.jsx)(u.b,Object(E.a)({},n)):Object(p.jsx)(u.a,{to:"/signin"})}function I(e){return Object(p.jsx)("div",{className:"popup popup_type_register ".concat(e.isOpen?"popup_opend":""),children:Object(p.jsxs)("div",{className:"popup__container",children:[Object(p.jsx)("button",{className:"popup__close",type:"button","aria-label":"\u0437\u0430\u043a\u0440\u044b\u0442\u044c",onClick:e.onClose}),Object(p.jsx)("div",{className:"popup__register ".concat(e.isInfoTooltip?"popup__register_done":"popup__register_error")}),Object(p.jsx)("h2",{className:"popup__title popup__title_register",children:e.isInfoTooltip?"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!":"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."})]})})}var A="https://api.workofplace.nomoredomains.club",R=function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))};var J=function(){var e=Object(u.g)({forceRefresh:!0}),t=Object(a.useState)(!1),n=Object(l.a)(t,2),c=n[0],s=n[1],i=Object(a.useState)(!1),o=Object(l.a)(i,2),j=o[0],h=o[1],_=Object(a.useState)(!1),f=Object(l.a)(_,2),k=f[0],y=f[1],L=Object(a.useState)(null),E=Object(l.a)(L,2),D=E[0],P=E[1],J=Object(a.useState)(null),q=Object(l.a)(J,2),F=q[0],B=q[1],H=Object(a.useState)(!1),M=Object(l.a)(H,2),z=M[0],G=M[1],K=Object(a.useState)(!1),Q=Object(l.a)(K,2),V=Q[0],W=Q[1],X=Object(a.useState)({}),Y=Object(l.a)(X,2),Z=Y[0],$=Y[1],ee=Object(a.useState)(""),te=Object(l.a)(ee,2),ne=te[0],ae=te[1],ce=Object(a.useState)([]),se=Object(l.a)(ce,2),ie=se[0],oe=se[1],re=Object(a.useState)(!1),le=Object(l.a)(re,2),ue=le[0],pe=le[1];function de(){s(!0)}function je(){h(!0)}function be(){y(!0)}function he(e){P(e)}function me(e){B(e)}function _e(){s(!1),h(!1),y(!1),P(null),B(null),G(!1)}function Oe(e){var t=e.likes.some((function(e){return e===Z._id}));S.setLikeCard(e._id,t).then((function(t){oe((function(n){return n.map((function(n){return n._id===e._id?t.data:n}))}))})).catch((function(e){console.log(e)}))}function fe(e){S.removeCard(e._id).then((function(){oe((function(t){return t.filter((function(t){return t._id!==e._id}))})),_e()})).catch((function(e){console.log(e)}))}return Object(a.useEffect)((function(){var e=function(e){"Escape"===e.key&&_e()};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[]),Object(a.useEffect)((function(){var e=function(e){e.target.classList.contains("popup_opend")&&_e()};return document.addEventListener("click",e),function(){return document.removeEventListener("click",e)}}),[]),Object(a.useEffect)((function(){Promise.all([S.getUserInfo(),S.getInitialCards()]).then((function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];$(n.data),oe(a.cards)})).catch((function(e){console.log(e)}))}),[]),Object(a.useEffect)((function(){var t,n=localStorage.getItem("jwt");n&&(t=n,fetch("".concat(A,"/users/me"),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){return R(e)}))).then((function(t){t&&(pe(!0),ae(t.data.email),e.push("/"))})).catch((function(e){console.log(e)}))}),[ue,e]),Object(p.jsx)(m.Provider,{value:Z,children:Object(p.jsxs)("div",{className:"page",children:[Object(p.jsx)(b,{userEmail:ne,onLogout:function(){localStorage.removeItem("jwt"),pe(!1),ae(""),e.push("/signin")}}),Object(p.jsxs)(u.d,{children:[Object(p.jsx)(u.b,{path:"/signup",children:Object(p.jsx)(w,{onRegisterSubmit:function(t,n){(function(e,t){return fetch("".concat(A,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:e,email:t})}).then((function(e){return R(e)}))})(t,n).then((function(t){G(!0),t&&(W(!0),e.push("/signin"))})).catch((function(e){console.log(e),G(!0),W(!1)}))}})}),Object(p.jsx)(u.b,{path:"/signin",children:Object(p.jsx)(U,{onLoginSubmit:function(t,n){ae(n),function(e,t){return fetch("".concat(A,"/signin"),{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:e,email:t})}).then()}(t,n).then((function(t){200===t.status?(pe(!0),localStorage.setItem("jwt",t.token),e.go("/")):(G(!0),W(!1))})).catch((function(e){console.log(e)}))}})}),Object(p.jsx)(T,{isLoggedIn:ue,path:"/",render:function(){return Object(p.jsx)(O,{onEditProfile:de,onAddPlace:je,onEditAvatar:be,cards:ie,onCardClick:he,onCardLike:Oe,onDeleteClick:me,onCardDelete:fe})}})]}),Object(p.jsx)(d,{}),Object(p.jsx)(x,{isOpen:c,onClose:_e,onUpdateUser:function(e){S.pushUserInfo(e).then((function(e){$(e.data),_e()})).catch((function(e){console.log(e)}))}}),Object(p.jsx)(v,{isOpen:j,onClose:_e,onAddPlace:function(e){S.pushNewCard(e).then((function(e){oe([e.data].concat(Object(r.a)(ie))),_e()})).catch((function(e){console.log(e)}))}}),Object(p.jsx)(g,{isOpen:k,onClose:_e,onUpdateAvatar:function(e){S.updateAvatar(e).then((function(e){$(e.data),console.log(e.data),_e()})).catch((function(e){console.log(e)}))}}),Object(p.jsx)(N,{card:!!D&&D,onClose:_e}),Object(p.jsx)(C,{isOpen:F,onClose:_e,onCardDelete:fe}),Object(p.jsx)(I,{isOpen:z,onClose:_e,isInfoTooltip:V})]})})},q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,38)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),s(e),i(e)}))};i.a.render(Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsx)(o.a,{children:Object(p.jsx)(J,{})})}),document.getElementById("root")),q()}},[[37,1,2]]]);
//# sourceMappingURL=main.72b135e6.chunk.js.map