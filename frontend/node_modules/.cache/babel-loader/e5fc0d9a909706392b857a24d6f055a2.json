{"ast":null,"code":"import _toConsumableArray from\"/Users/mac/Documents/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/mac/Documents/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{Route,Switch,useHistory}from'react-router-dom';import{Footer}from'./Footer';import{Header}from'./Header';import{Main}from'./Main';import{EditProfilePopup}from'./EditProfilePopup';import{AddPlacePopup}from'./AddPlacePopup';import{EditAvatarPopup}from'./EditAvatarPopup';import{ImagePopup}from'./ImagePopup';import{ConfirmPopup}from'./ConfirmPopup';import api from'../utils/api';import{CurrentUserContext}from'../contexts/CurrentUserContext';import{Register}from'./Register';import{Login}from'./Login';import{ProtectedRoute}from'./ProtectedRoute';import{InfoTooltip}from'./InfoTooltip';import*as auth from'../utils/auth';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var history=useHistory();// попапы \nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditProfilePopupOpen=_useState2[0],setEditProfileState=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAddPlacePopupOpen=_useState4[0],setAddPlaceState=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isEditAvatarPopupOpen=_useState6[0],setEditAvatarState=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),selectedCard=_useState8[0],setSelectedCard=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),removedCard=_useState10[0],setRemovedCard=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isInfoTooltipOpen=_useState12[0],setInfoTooltipState=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),infoTooltip=_useState14[0],setInfoTooltip=_useState14[1];// пользователь и карточки \nvar _useState15=useState({}),_useState16=_slicedToArray(_useState15,2),currentUser=_useState16[0],setCurrentUserState=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),userEmail=_useState18[0],setUserEmail=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),cards=_useState20[0],setCardsState=_useState20[1];// регистрация\nvar _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),loggedIn=_useState22[0],setLoggedInState=_useState22[1];// открытие и закрытие попапов \nfunction handleEditProfileClick(){setEditProfileState(true);};function handleAddPlaceClick(){setAddPlaceState(true);};function handleEditAvatarClick(){setEditAvatarState(true);};function handleCardClick(card){setSelectedCard(card);};function handleDeleteClick(card){setRemovedCard(card);};function closeAllPopups(){setEditProfileState(false);setAddPlaceState(false);setEditAvatarState(false);setSelectedCard(null);setRemovedCard(null);setInfoTooltipState(false);};// обработчик Escape и overlay\nuseEffect(function(){var closeByEscape=function closeByEscape(evt){if(evt.key==='Escape'){closeAllPopups();};};document.addEventListener('keydown',closeByEscape);return function(){return document.removeEventListener('keydown',closeByEscape);};},[]);useEffect(function(){var closeByOverlay=function closeByOverlay(evt){if(evt.target.classList.contains('popup_opend')){closeAllPopups();};};document.addEventListener('click',closeByOverlay);return function(){return document.removeEventListener('click',closeByOverlay);};},[]);useEffect(function(){Promise.all([api.getUserInfo(),api.getInitialCards()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),userData=_ref2[0],cardData=_ref2[1];setCurrentUserState(userData);setCardsState(cardData);}).catch(function(err){console.log(err);});},[]);// пользователь \nfunction handleUpdateUser(data){api.pushUserInfo(data).then(function(result){setCurrentUserState(result);closeAllPopups();}).catch(function(err){console.log(err);});};function handleUpdateAvatar(data){api.updateAvatar(data).then(function(result){setCurrentUserState(result);closeAllPopups();}).catch(function(err){console.log(err);});};// карточки \nfunction handleAddPlaceSubmit(data){api.pushNewCard(data).then(function(newCard){setCardsState([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);});};function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});api.setLikeCard(card._id,isLiked).then(function(newCard){setCardsState(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});};function handleCardDelete(card){api.removeCard(card._id).then(function(){setCardsState(function(state){return state.filter(function(item){return item._id!==card._id;});});closeAllPopups();}).catch(function(err){console.log(err);});};// подтверждение регистрации\nfunction handleRegisterSubmit(password,email){auth.register(password,email).then(function(data){setInfoTooltipState(true);if(data){setInfoTooltip(true);history.push('/sign-in');}else{setInfoTooltip(false);}}).catch(function(err){console.log(err);});};// вход \nfunction handleLoginSubmit(password,email){setUserEmail(email);auth.authorize(password,email).then(function(data){if(data.token){setLoggedInState(true);localStorage.setItem('jwt',data.token);history.push('/');}}).catch(function(err){console.log(err);});};// проверка токена\nuseEffect(function(){var jwt=localStorage.getItem('jwt');if(jwt){auth.getContent(jwt).then(function(res){if(res){setLoggedInState(true);setUserEmail(res.data.email);history.push('/');}}).catch(function(err){console.log(err);});}},[loggedIn,history]);//выход\nfunction handleLogout(){localStorage.removeItem('jwt');setLoggedInState(false);setUserEmail('');history.push('/sign-in');}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{userEmail:userEmail,onLogout:handleLogout}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{onRegisterSubmit:handleRegisterSubmit})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{onLoginSubmit:handleLoginSubmit})}),/*#__PURE__*/_jsx(ProtectedRoute,{isLoggedIn:loggedIn,path:\"/\",render:function render(){return/*#__PURE__*/_jsx(Main,{onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,cards:cards,onCardClick:handleCardClick,onCardLike:handleCardLike,onDeleteClick:handleDeleteClick,onCardDelete:handleCardDelete});}})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(ImagePopup,{card:!!selectedCard&&selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(ConfirmPopup,{isOpen:removedCard,onClose:closeAllPopups,onCardDelete:handleCardDelete}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,onClose:closeAllPopups,isInfoTooltip:infoTooltip})]})});}export default App;","map":{"version":3,"sources":["/Users/mac/Documents/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["useState","useEffect","Route","Switch","useHistory","Footer","Header","Main","EditProfilePopup","AddPlacePopup","EditAvatarPopup","ImagePopup","ConfirmPopup","api","CurrentUserContext","Register","Login","ProtectedRoute","InfoTooltip","auth","App","history","isEditProfilePopupOpen","setEditProfileState","isAddPlacePopupOpen","setAddPlaceState","isEditAvatarPopupOpen","setEditAvatarState","selectedCard","setSelectedCard","removedCard","setRemovedCard","isInfoTooltipOpen","setInfoTooltipState","infoTooltip","setInfoTooltip","currentUser","setCurrentUserState","userEmail","setUserEmail","cards","setCardsState","loggedIn","setLoggedInState","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleCardClick","card","handleDeleteClick","closeAllPopups","closeByEscape","evt","key","document","addEventListener","removeEventListener","closeByOverlay","target","classList","contains","Promise","all","getUserInfo","getInitialCards","then","userData","cardData","catch","err","console","log","handleUpdateUser","data","pushUserInfo","result","handleUpdateAvatar","updateAvatar","handleAddPlaceSubmit","pushNewCard","newCard","handleCardLike","isLiked","likes","some","i","_id","setLikeCard","state","map","c","handleCardDelete","removeCard","filter","item","handleRegisterSubmit","password","email","register","push","handleLoginSubmit","authorize","token","localStorage","setItem","jwt","getItem","getContent","res","handleLogout","removeItem"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'; \nimport { Route, Switch, useHistory } from 'react-router-dom';\nimport { Footer } from './Footer'; \nimport { Header } from './Header'; \nimport { Main } from './Main'; \nimport { EditProfilePopup } from './EditProfilePopup'; \nimport { AddPlacePopup } from './AddPlacePopup'; \nimport { EditAvatarPopup } from './EditAvatarPopup'; \nimport { ImagePopup } from './ImagePopup'; \nimport { ConfirmPopup } from './ConfirmPopup'; \nimport api from '../utils/api'; \nimport { CurrentUserContext } from '../contexts/CurrentUserContext'; \nimport { Register } from './Register';\nimport { Login } from './Login';\nimport { ProtectedRoute } from './ProtectedRoute'; \nimport { InfoTooltip } from './InfoTooltip';\nimport * as auth from '../utils/auth';\n \nfunction App() { \n  const history = useHistory();\n\n  // попапы \n  const [isEditProfilePopupOpen, setEditProfileState] = useState(false); \n  const [isAddPlacePopupOpen, setAddPlaceState] = useState(false); \n  const [isEditAvatarPopupOpen, setEditAvatarState] = useState(false); \n  const [selectedCard, setSelectedCard] = useState(null); \n  const [removedCard, setRemovedCard] = useState(null); \n  const [isInfoTooltipOpen, setInfoTooltipState] = useState(false);\n  const [infoTooltip, setInfoTooltip] = useState(false);\n \n  // пользователь и карточки \n  const [currentUser, setCurrentUserState] = useState({}); \n  const [userEmail, setUserEmail] = useState('');\n  const [cards, setCardsState] = useState([]); \n\n  // регистрация\n  const [loggedIn, setLoggedInState] = useState(false);\n \n  // открытие и закрытие попапов \n  function handleEditProfileClick() { \n    setEditProfileState(true); \n  }; \n  function handleAddPlaceClick() { \n    setAddPlaceState(true); \n  }; \n  function handleEditAvatarClick() { \n    setEditAvatarState(true); \n  }; \n  function handleCardClick(card) { \n    setSelectedCard(card); \n  }; \n  function handleDeleteClick(card) { \n    setRemovedCard(card); \n  }; \n \n  function closeAllPopups() { \n    setEditProfileState(false); \n    setAddPlaceState(false); \n    setEditAvatarState(false); \n    setSelectedCard(null); \n    setRemovedCard(null); \n    setInfoTooltipState(false);\n  }; \n   \n  // обработчик Escape и overlay\n  useEffect(() => {\n    const closeByEscape = (evt) => {\n      if(evt.key === 'Escape') {\n        closeAllPopups();\n      };\n    };\n    document.addEventListener('keydown', closeByEscape);\n    return () => document.removeEventListener('keydown', closeByEscape);\n  }, []);\n\n  useEffect(() => {\n    const closeByOverlay = (evt) => {\n      if(evt.target.classList.contains('popup_opend')) {\n        closeAllPopups();\n      };\n    };\n    document.addEventListener('click', closeByOverlay);\n    return () => document.removeEventListener('click', closeByOverlay);\n  }, []);\n \n  useEffect(() => { \n    Promise.all([ \n      api.getUserInfo(), \n      api.getInitialCards(), \n    ]) \n    .then(([userData, cardData]) => { \n      setCurrentUserState(userData); \n      setCardsState(cardData); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }) \n  }, []); \n \n  // пользователь \n  function handleUpdateUser (data) { \n    api.pushUserInfo(data) \n    .then((result) => { \n      setCurrentUserState(result); \n      closeAllPopups(); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }) \n  }; \n \n  function handleUpdateAvatar(data) { \n    api.updateAvatar(data) \n    .then((result) => { \n      setCurrentUserState(result); \n      closeAllPopups(); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }) \n  }; \n \n  // карточки \n  function handleAddPlaceSubmit(data) { \n    api.pushNewCard(data) \n    .then((newCard) => { \n      setCardsState([newCard, ...cards]); \n      closeAllPopups(); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }) \n  }; \n \n  function handleCardLike(card) { \n    const isLiked = card.likes.some(i => i._id === currentUser._id); \n    api.setLikeCard(card._id, isLiked) \n    .then((newCard) => { \n      setCardsState((state) => state.map((c) => c._id === card._id ? newCard : c)); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }); \n  }; \n \n  function handleCardDelete(card) { \n    api.removeCard(card._id) \n    .then(() => { \n      setCardsState((state) => state.filter(item => item._id !== card._id)); \n      closeAllPopups(); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }); \n  }; \n\n  // подтверждение регистрации\n  function handleRegisterSubmit(password, email) {\n    auth.register(password, email)\n    .then((data) => {\n      setInfoTooltipState(true);\n      if(data) {\n        setInfoTooltip(true);\n        history.push('/sign-in');\n      } else {\n        setInfoTooltip(false);\n      }\n    })\n    .catch((err) => {\n      console.log(err);\n    })\n  };\n\n  // вход \n  function handleLoginSubmit(password, email) {\n    setUserEmail(email);\n    auth.authorize(password, email)\n    .then((data) => {\n      if(data.token) {\n        setLoggedInState(true);\n        localStorage.setItem('jwt', data.token);\n        history.push('/');\n      }\n    })\n    .catch((err) => {\n      console.log(err);\n    })\n  };\n\n  // проверка токена\n  useEffect(() => {\n    const jwt = localStorage.getItem('jwt');\n    if(jwt) {\n      auth.getContent(jwt)\n      .then((res) => {\n        if(res) {\n          setLoggedInState(true);\n          setUserEmail(res.data.email);\n          history.push('/');\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n      })\n    }\n  }, [loggedIn, history]);\n\n  //выход\n  function handleLogout() {\n    localStorage.removeItem('jwt');\n    setLoggedInState(false);\n    setUserEmail('');\n    history.push('/sign-in');\n  }\n\n \n  return ( \n    <CurrentUserContext.Provider value={currentUser}> \n    <div className=\"page\"> \n      <Header \n      userEmail={userEmail}\n      onLogout={handleLogout} /> \n\n      <Switch>\n        <Route path=\"/sign-up\">\n          <Register \n          onRegisterSubmit = {handleRegisterSubmit}\n          />\n        </Route>\n\n        <Route path=\"/sign-in\">\n          <Login\n          onLoginSubmit = {handleLoginSubmit} />\n        </Route>\n\n        <ProtectedRoute\n          isLoggedIn = {loggedIn} path = \"/\" render = {() => {\n            return <Main  \n            onEditProfile = {handleEditProfileClick}  \n            onAddPlace = {handleAddPlaceClick} \n            onEditAvatar = {handleEditAvatarClick} \n            cards = {cards} \n            onCardClick = {handleCardClick} \n            onCardLike = {handleCardLike} \n            onDeleteClick = {handleDeleteClick} \n            onCardDelete = {handleCardDelete} />;\n          }} />\n      </Switch>\n \n      <Footer /> \n \n      <EditProfilePopup isOpen={isEditProfilePopupOpen} onClose={closeAllPopups} onUpdateUser={handleUpdateUser} /> \n      <AddPlacePopup isOpen={isAddPlacePopupOpen} onClose={closeAllPopups} onAddPlace={handleAddPlaceSubmit} /> \n      <EditAvatarPopup isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups} onUpdateAvatar={handleUpdateAvatar} /> \n      <ImagePopup card={!!selectedCard && selectedCard} onClose={closeAllPopups} /> \n      <ConfirmPopup isOpen={removedCard} onClose={closeAllPopups} onCardDelete={handleCardDelete} /> \n      <InfoTooltip isOpen={isInfoTooltipOpen} onClose={closeAllPopups} isInfoTooltip={infoTooltip} />\n    </div> \n    </CurrentUserContext.Provider> \n  ); \n} \n \nexport default App;"]},"metadata":{},"sourceType":"module"}