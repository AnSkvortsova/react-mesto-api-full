{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/dev/react-mesto-auth/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from 'react';\nimport { Route, Switch, useHistory } from 'react-router-dom';\nimport { Footer } from './Footer';\nimport { Header } from './Header';\nimport { Main } from './Main';\nimport { EditProfilePopup } from './EditProfilePopup';\nimport { AddPlacePopup } from './AddPlacePopup';\nimport { EditAvatarPopup } from './EditAvatarPopup';\nimport { ImagePopup } from './ImagePopup';\nimport { ConfirmPopup } from './ConfirmPopup';\nimport api from '../utils/api';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport { Register } from './Register';\nimport { Login } from './Login';\nimport { ProtectedRoute } from './ProtectedRoute';\nimport { InfoTooltip } from './InfoTooltip';\nimport * as auth from '../utils/auth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const history = useHistory(); // попапы \n\n  const [isEditProfilePopupOpen, setEditProfileState] = useState(false);\n  const [isAddPlacePopupOpen, setAddPlaceState] = useState(false);\n  const [isEditAvatarPopupOpen, setEditAvatarState] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [removedCard, setRemovedCard] = useState(null);\n  const [isInfoTooltipOpen, setInfoTooltipState] = useState(false);\n  const [infoTooltip, setInfoTooltip] = useState(false); // пользователь и карточки \n\n  const [currentUser, setCurrentUserState] = useState({});\n  const [userEmail, setUserEmail] = useState('');\n  const [cards, setCardsState] = useState([]); // регистрация\n\n  const [loggedIn, setLoggedInState] = useState(false); // открытие и закрытие попапов \n\n  function handleEditProfileClick() {\n    setEditProfileState(true);\n  }\n\n  ;\n\n  function handleAddPlaceClick() {\n    setAddPlaceState(true);\n  }\n\n  ;\n\n  function handleEditAvatarClick() {\n    setEditAvatarState(true);\n  }\n\n  ;\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n  }\n\n  ;\n\n  function handleDeleteClick(card) {\n    setRemovedCard(card);\n  }\n\n  ;\n\n  function closeAllPopups() {\n    setEditProfileState(false);\n    setAddPlaceState(false);\n    setEditAvatarState(false);\n    setSelectedCard(null);\n    setRemovedCard(null);\n    setInfoTooltipState(false);\n  }\n\n  ; // обработчик Escape\n\n  useEffect(() => {\n    const closeByEscape = evt => {\n      if (evt.key === 'Escape') {\n        closeAllPopups();\n      }\n    };\n\n    document.addEventListener('keydown', closeByEscape);\n    return document.removeEventListener('keydown', closeByEscape);\n  }, []);\n  useEffect(() => {\n    Promise.all([api.getUserInfo(), api.getInitialCards()]).then(([userData, cardData]) => {\n      setCurrentUserState(userData);\n      setCardsState(cardData);\n    }).catch(err => {\n      console.log(err);\n    });\n  }, []); // пользователь \n\n  function handleUpdateUser(data) {\n    api.pushUserInfo(data).then(result => {\n      setCurrentUserState(result);\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  ;\n\n  function handleUpdateAvatar(data) {\n    api.updateAvatar(data).then(result => {\n      setCurrentUserState(result);\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  ; // карточки \n\n  function handleAddPlaceSubmit(data) {\n    api.pushNewCard(data).then(newCard => {\n      setCardsState([newCard, ...cards]);\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  ;\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    api.setLikeCard(card._id, isLiked).then(newCard => {\n      setCardsState(state => state.map(c => c._id === card._id ? newCard : c));\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  ;\n\n  function handleCardDelete(card) {\n    api.removeCard(card._id).then(() => {\n      setCardsState(state => state.filter(item => item._id !== card._id));\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  ; // подтверждение регистрации\n\n  function handleRegisterSubmit(password, email) {\n    auth.register(password, email).then(data => {\n      setInfoTooltipState(true);\n\n      if (data) {\n        setInfoTooltip(true);\n        history.push('/sign-in');\n      } else {\n        setInfoTooltip(false);\n      }\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  ; // вход \n\n  function handleLoginSubmit(password, email) {\n    setUserEmail(email);\n    auth.authorize(password, email).then(data => {\n      if (data.token) {\n        setLoggedInState(true);\n        localStorage.setItem('jwt', data.token);\n        history.push('/');\n      }\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  ; // проверка токена\n\n  useEffect(() => {\n    const jwt = localStorage.getItem('jwt');\n\n    if (jwt) {\n      auth.getContent(jwt).then(res => {\n        if (res) {\n          setLoggedInState(true);\n          setUserEmail(res.data.email);\n          history.push('/');\n        }\n      }).catch(err => {\n        console.log(err);\n      });\n    }\n  }, [loggedIn, history]); //выход\n\n  function handleLogout() {\n    localStorage.removeItem('jwt');\n    setLoggedInState(false);\n    setUserEmail('');\n    history.push('/sign-in');\n  }\n\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: currentUser,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"page\",\n      children: [/*#__PURE__*/_jsxDEV(Header, {\n        userEmail: userEmail,\n        onLogout: handleLogout\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(Switch, {\n        children: [/*#__PURE__*/_jsxDEV(Route, {\n          path: \"/sign-up\",\n          children: /*#__PURE__*/_jsxDEV(Register, {\n            onRegisterSubmit: handleRegisterSubmit\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/sign-in\",\n          children: /*#__PURE__*/_jsxDEV(Login, {\n            onLoginSubmit: handleLoginSubmit\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 222,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(ProtectedRoute, {\n          isLoggedIn: loggedIn,\n          path: \"/\",\n          render: () => {\n            return /*#__PURE__*/_jsxDEV(Main, {\n              onEditProfile: handleEditProfileClick,\n              onAddPlace: handleAddPlaceClick,\n              onEditAvatar: handleEditAvatarClick,\n              cards: cards,\n              onCardClick: handleCardClick,\n              onCardLike: handleCardLike,\n              onDeleteClick: handleDeleteClick,\n              onCardDelete: handleCardDelete\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 228,\n              columnNumber: 20\n            }, this);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n        isOpen: isEditProfilePopupOpen,\n        onClose: closeAllPopups,\n        onUpdateUser: handleUpdateUser\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n        isOpen: isAddPlacePopupOpen,\n        onClose: closeAllPopups,\n        onAddPlace: handleAddPlaceSubmit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n        isOpen: isEditAvatarPopupOpen,\n        onClose: closeAllPopups,\n        onUpdateAvatar: handleUpdateAvatar\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n        card: !!selectedCard && selectedCard,\n        onClose: closeAllPopups\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(ConfirmPopup, {\n        isOpen: removedCard,\n        onClose: closeAllPopups,\n        onCardDelete: handleCardDelete\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(InfoTooltip, {\n        isOpen: isInfoTooltipOpen,\n        onClose: closeAllPopups,\n        isInfoTooltip: infoTooltip\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 208,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"35PkvXa1OJkWgXvyA037PrXHbyY=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/mac/Documents/dev/react-mesto-auth/src/components/App.js"],"names":["useState","useEffect","Route","Switch","useHistory","Footer","Header","Main","EditProfilePopup","AddPlacePopup","EditAvatarPopup","ImagePopup","ConfirmPopup","api","CurrentUserContext","Register","Login","ProtectedRoute","InfoTooltip","auth","App","history","isEditProfilePopupOpen","setEditProfileState","isAddPlacePopupOpen","setAddPlaceState","isEditAvatarPopupOpen","setEditAvatarState","selectedCard","setSelectedCard","removedCard","setRemovedCard","isInfoTooltipOpen","setInfoTooltipState","infoTooltip","setInfoTooltip","currentUser","setCurrentUserState","userEmail","setUserEmail","cards","setCardsState","loggedIn","setLoggedInState","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleCardClick","card","handleDeleteClick","closeAllPopups","closeByEscape","evt","key","document","addEventListener","removeEventListener","Promise","all","getUserInfo","getInitialCards","then","userData","cardData","catch","err","console","log","handleUpdateUser","data","pushUserInfo","result","handleUpdateAvatar","updateAvatar","handleAddPlaceSubmit","pushNewCard","newCard","handleCardLike","isLiked","likes","some","i","_id","setLikeCard","state","map","c","handleCardDelete","removeCard","filter","item","handleRegisterSubmit","password","email","register","push","handleLoginSubmit","authorize","token","localStorage","setItem","jwt","getItem","getContent","res","handleLogout","removeItem"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'; \nimport { Route, Switch, useHistory } from 'react-router-dom';\nimport { Footer } from './Footer'; \nimport { Header } from './Header'; \nimport { Main } from './Main'; \nimport { EditProfilePopup } from './EditProfilePopup'; \nimport { AddPlacePopup } from './AddPlacePopup'; \nimport { EditAvatarPopup } from './EditAvatarPopup'; \nimport { ImagePopup } from './ImagePopup'; \nimport { ConfirmPopup } from './ConfirmPopup'; \nimport api from '../utils/api'; \nimport { CurrentUserContext } from '../contexts/CurrentUserContext'; \nimport { Register } from './Register';\nimport { Login } from './Login';\nimport { ProtectedRoute } from './ProtectedRoute'; \nimport { InfoTooltip } from './InfoTooltip';\nimport * as auth from '../utils/auth';\n \nfunction App() { \n  const history = useHistory();\n\n  // попапы \n  const [isEditProfilePopupOpen, setEditProfileState] = useState(false); \n  const [isAddPlacePopupOpen, setAddPlaceState] = useState(false); \n  const [isEditAvatarPopupOpen, setEditAvatarState] = useState(false); \n  const [selectedCard, setSelectedCard] = useState(null); \n  const [removedCard, setRemovedCard] = useState(null); \n  const [isInfoTooltipOpen, setInfoTooltipState] = useState(false);\n  const [infoTooltip, setInfoTooltip] = useState(false);\n \n  // пользователь и карточки \n  const [currentUser, setCurrentUserState] = useState({}); \n  const [userEmail, setUserEmail] = useState('');\n  const [cards, setCardsState] = useState([]); \n\n  // регистрация\n  const [loggedIn, setLoggedInState] = useState(false);\n \n  // открытие и закрытие попапов \n  function handleEditProfileClick() { \n    setEditProfileState(true); \n  }; \n  function handleAddPlaceClick() { \n    setAddPlaceState(true); \n  }; \n  function handleEditAvatarClick() { \n    setEditAvatarState(true); \n  }; \n  function handleCardClick(card) { \n    setSelectedCard(card); \n  }; \n  function handleDeleteClick(card) { \n    setRemovedCard(card); \n  }; \n \n  function closeAllPopups() { \n    setEditProfileState(false); \n    setAddPlaceState(false); \n    setEditAvatarState(false); \n    setSelectedCard(null); \n    setRemovedCard(null); \n    setInfoTooltipState(false);\n  }; \n   \n  // обработчик Escape\n  useEffect(() => {\n    const closeByEscape = (evt) => {\n      if(evt.key === 'Escape') {\n        closeAllPopups();\n      }\n    }\n    document.addEventListener('keydown', closeByEscape);\n    return document.removeEventListener('keydown', closeByEscape);\n  }, []);\n \n  useEffect(() => { \n    Promise.all([ \n      api.getUserInfo(), \n      api.getInitialCards(), \n    ]) \n    .then(([userData, cardData]) => { \n      setCurrentUserState(userData); \n      setCardsState(cardData); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }) \n  }, []); \n \n  // пользователь \n  function handleUpdateUser (data) { \n    api.pushUserInfo(data) \n    .then((result) => { \n      setCurrentUserState(result); \n      closeAllPopups(); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }) \n  }; \n \n  function handleUpdateAvatar(data) { \n    api.updateAvatar(data) \n    .then((result) => { \n      setCurrentUserState(result); \n      closeAllPopups(); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }) \n  }; \n \n  // карточки \n  function handleAddPlaceSubmit(data) { \n    api.pushNewCard(data) \n    .then((newCard) => { \n      setCardsState([newCard, ...cards]); \n      closeAllPopups(); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }) \n  }; \n \n  function handleCardLike(card) { \n    const isLiked = card.likes.some(i => i._id === currentUser._id); \n    api.setLikeCard(card._id, isLiked) \n    .then((newCard) => { \n      setCardsState((state) => state.map((c) => c._id === card._id ? newCard : c)); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }); \n  }; \n \n  function handleCardDelete(card) { \n    api.removeCard(card._id) \n    .then(() => { \n      setCardsState((state) => state.filter(item => item._id !== card._id)); \n      closeAllPopups(); \n    }) \n    .catch((err) => { \n      console.log(err) \n    }); \n  }; \n\n  // подтверждение регистрации\n  function handleRegisterSubmit(password, email) {\n    auth.register(password, email)\n    .then((data) => {\n      setInfoTooltipState(true);\n      if(data) {\n        setInfoTooltip(true);\n        history.push('/sign-in');\n      } else {\n        setInfoTooltip(false);\n      }\n    })\n    .catch((err) => {\n      console.log(err);\n    })\n  };\n\n  // вход \n  function handleLoginSubmit(password, email) {\n    setUserEmail(email);\n    auth.authorize(password, email)\n    .then((data) => {\n      if(data.token) {\n        setLoggedInState(true);\n        localStorage.setItem('jwt', data.token);\n        history.push('/');\n      }\n    })\n    .catch((err) => {\n      console.log(err);\n    })\n  };\n\n  // проверка токена\n  useEffect(() => {\n    const jwt = localStorage.getItem('jwt');\n    if(jwt) {\n      auth.getContent(jwt)\n      .then((res) => {\n        if(res) {\n          setLoggedInState(true);\n          setUserEmail(res.data.email);\n          history.push('/');\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n      })\n    }\n  }, [loggedIn, history]);\n\n  //выход\n  function handleLogout() {\n    localStorage.removeItem('jwt');\n    setLoggedInState(false);\n    setUserEmail('');\n    history.push('/sign-in');\n  }\n\n \n  return ( \n    <CurrentUserContext.Provider value={currentUser}> \n    <div className=\"page\"> \n      <Header \n      userEmail={userEmail}\n      onLogout={handleLogout} /> \n\n      <Switch>\n        <Route path=\"/sign-up\">\n          <Register \n          onRegisterSubmit = {handleRegisterSubmit}\n          />\n        </Route>\n\n        <Route path=\"/sign-in\">\n          <Login\n          onLoginSubmit = {handleLoginSubmit} />\n        </Route>\n\n        <ProtectedRoute\n          isLoggedIn = {loggedIn} path = \"/\" render = {() => {\n            return <Main  \n            onEditProfile = {handleEditProfileClick}  \n            onAddPlace = {handleAddPlaceClick} \n            onEditAvatar = {handleEditAvatarClick} \n            cards = {cards} \n            onCardClick = {handleCardClick} \n            onCardLike = {handleCardLike} \n            onDeleteClick = {handleDeleteClick} \n            onCardDelete = {handleCardDelete} />;\n          }} />\n      </Switch>\n \n      <Footer /> \n \n      <EditProfilePopup isOpen={isEditProfilePopupOpen} onClose={closeAllPopups} onUpdateUser={handleUpdateUser} /> \n      <AddPlacePopup isOpen={isAddPlacePopupOpen} onClose={closeAllPopups} onAddPlace={handleAddPlaceSubmit} /> \n      <EditAvatarPopup isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups} onUpdateAvatar={handleUpdateAvatar} /> \n      <ImagePopup card={!!selectedCard && selectedCard} onClose={closeAllPopups} /> \n      <ConfirmPopup isOpen={removedCard} onClose={closeAllPopups} onCardDelete={handleCardDelete} /> \n      <InfoTooltip isOpen={isInfoTooltipOpen} onClose={closeAllPopups} isInfoTooltip={infoTooltip} />\n    </div> \n    </CurrentUserContext.Provider> \n  ); \n} \n \nexport default App;"]},"metadata":{},"sourceType":"module"}